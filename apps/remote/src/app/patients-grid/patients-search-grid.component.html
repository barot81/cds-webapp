<div class="
page-layout
carded
fullwidth
full-width-page
inner-scroll
zhealthcare-new-grid
pt-8
  ">
  <div class="student-search-report  table-rounded-border p-0">
    <div class="spinner-container" *ngIf="datasourceFacade.fusionDataSourceLoading$ | async">
      <mat-spinner color="accent"></mat-spinner>
    </div>
    <div class=" white-background " fusePerfectScrollbar>
      <div #profileSearchHeader>
        <div fxLayout="column">
          <div fxLayout="row" fxLayoutAlign="space-between center" class="w-100-p">
            <div fxLayout="row" fxLayoutAlign="start center" fxFlex.lt-md="100">
              <div class="search-wrapper" fxFlex="100">
                <div class="search table-search" fxFlex fxLayout="row" fxLayoutAlign="start center">
                  <i aria-hidden="true" class="fa-light fa-magnifying-glass s-18 mr-4"></i>
                  <input matInput [(ngModel)]="searchText" #searchInput #matInput type="text"
                    placeholder="Search" fxFlex />
                  <button *ngIf="searchText && searchText!==''" mat-icon-button aria-label="clear search"
                    class="action-icon clear-button" (click)="textChanged('')">
                    <i aria-hidden="true" class="fa-light fa-xmark s-14"></i>
                  </button>
                </div>
              </div>


              <div *ngIf="numberOfAppliedFilter>0" fxLayout="row" fxLayoutAlign="start center" class="px-16 w-100-p"
                fxHide.lt-lg>
                <div fxLayout="row" fxLayoutAlign="start center" class="mr-8">
                  <span>Filters: </span>
                </div>
                <div fxLayout="row" fxLayoutAlign="start center" class="mr-16">
                  <div class="table-header-chips">
                    <mat-chip-list #chipList>
                      <div *ngFor="let item of gridFilter; let i = index">
                        <div *ngIf="i < 2" fxLayout="row" fxLayoutAlign="start center">
                          <div fxLayout="row" fxLayoutAlign="start center"
                            *ngFor="let fil of getFilterValue(item.value);let j = index">
                        <mat-chip *ngIf="gridFilter.length - 1 === 0 ? j < 2 : j < 1" (removed)="clearFilters(fil, item)">
                          <span tooltip="{{item.displayName}} : {{ fil }}" [options]="tooltipOptions" class="chips-text"
                          >{{ fil | chipsCharSlice }}</span>
                          <button matChipRemove>
                            <mat-icon>cancel</mat-icon>
                          </button>
                        </mat-chip>
                        </div>
                      </div>
                    </div>
                    </mat-chip-list>
                  </div>
                </div>
                <div fxLayout="row" fxLayoutAlign="start center" *ngIf="numberOfAppliedFilter > 2">
                  <a zhealthcareDrawerAction [componentSelector]="_profileFormsService.get('profile-show-more')"
                    [size]="'drawer-sm'" [data]="showMoreFilters" [primaryAction]="'Apply'"
                    [caption]="'Show More Filters'" *ngIf="numberOfAppliedFilter> 2">Show more</a>
                </div>
              </div>
            </div>

            <div fxLayout="row" fxLayoutAlign="end center">
              <div fxLayout="row" fxLayoutAlign="end center" class="border-right h-48" fxHide.lt-md>
                <button mat-stroked-button color="primary" class="mr-12" aria-label="A" zhealthcareDrawerAction
                  [componentSelector]="
                  _profileFormsService.get('profile-add-student-form')
                " [size]="'drawer-sm'" [caption]="'Add Student'" [primaryAction]="'Save'"
                  featureCode="{{ profileCode }}" [params]="{ CAN: ['WRITE'] }" role="img" [entityKey]="'0'">
                  <i aria-hidden="true" class="fa-light fa-plus s-16"></i>
                  <span class="ml-4">Add Patient</span>
                </button>

              </div>
              <div fxLayout="row" class="mr-16 ml-8">
                <button matTooltip="Export" tabindex="0" aria-label="Export Table" (click)="exportAsXLSX()"
                  mat-icon-button class=" ml-8" fxHide.lt-md>
                  <i aria-hidden="true" *ngIf="!exportInProgress" class="fa-light fa-file-export s-18"></i>
                  <mat-spinner *ngIf="exportInProgress" diameter="20" color="accent"></mat-spinner>
                </button>

                <zhealthcare-edit-columns fxHide.lt-md></zhealthcare-edit-columns>

                <button matTooltip="Filter" mat-icon-button class="ml-4 filter-icon-button" aria-label="filters"
                  zhealthcareDrawerAction [componentSelector]="
                    _profileFormsService.get(
                      'profile-student-landing-grid-filter-form')
                  " [size]="'drawer-md'" [caption]="'Filters'" [primaryAction]="'Apply'">
                  <div fxLayout="row" fxLayoutAlign="start center">
                    <i aria-hidden="true" class="fal fa-filter s-18 mr-4"></i>
                    <span *ngIf="numberOfAppliedFilter>0"> {{ gridFilter.length }} </span>
                  </div>
                </button>

                <button tabindex="0" aria-label="mat menu" mat-icon-button [matMenuTriggerFor]="menu" class="ml-4"
                  fxHide.gt-sm>
                  <i aria-hidden="true" class="fal fa-ellipsis-h s-18"></i>
                </button>
                <mat-menu #menu="matMenu" fxHide.gt-sm>
                  <button mat-menu-item color="primary" aria-label="A" zhealthcareDrawerAction
                    [componentSelector]="_profileFormsService.get('profile-add-student-form')" [size]="'drawer-sm'"
                    [caption]="'Add Patient'" [primaryAction]="'Save'" featureCode="{{ profileCode }}"
                    [params]="{ CAN: ['WRITE'] }" role="img" [entityKey]="'0'">
                    <i aria-hidden="true" class="fa-light fa-plus s-16"></i>
                    <span class="ml-4">Add Patient</span>
                  </button>
                  <button mat-menu-item aria-label="Edit Columns" zhealthcareDrawerAction
                    [componentSelector]="dataSourceComponentService.get('zhealthcare-display-columns-form')"
                    [size]="'drawer-sm'" [caption]="'Edit Columns'" role="img" [primaryAction]="'Save'"
                    aria-hidden="true">
                    <i aria-hidden="true" class="fa-light fa-wrench s-18 mr-8"></i>Edit columns
                  </button>
                  <button mat-menu-item aria-label="Export Table" (click)="exportAsXLSX()">
                    <i aria-hidden="true" *ngIf="!exportInProgress" class="fa-light fa-file-export s-18 mr-8"></i>Export table
                    <mat-spinner *ngIf="exportInProgress" diameter="20" color="accent"></mat-spinner>
                  </button>
                </mat-menu>
              </div>
            </div>
          </div>

          <div
            *ngIf="(datasourceFacade.fusionDataSourceLoading$ | async ) === false && ((searchText && searchText!=='') || numberOfAppliedFilter>0)"
            tabindex="0" aria-label="2 search results found">
            <div *ngIf=" (datasourceFacade.dataSourceTotal$ | async)!==0; else NoData"
              class="result-found-style w-100-p">
              {{ datasourceFacade.dataSourceTotal$ | async }} Results Found
            </div>

          </div>
        </div>
      </div>

      <div class="content zhealthcare-sticky-table overflow-auto" [ngClass]="{'student-search-grid-with-filter':((searchText && searchText!=='') || numberOfAppliedFilter>0) && (datasourceFacade.fusionDataSourceLoading$ | async ) === false,
      'student-search-grid-without-filter':!((searchText && searchText!=='') || numberOfAppliedFilter>0) && (datasourceFacade.fusionDataSourceLoading$ | async ) === false,
  'student-search-grid-with-loadingstate':(datasourceFacade.fusionDataSourceLoading$ | async )}"
        (scroll)="scrollHandler($event)">
        <table id="stickyColumnTable" aria-label="This is a Simple table" mat-table
          [dataSource]="datasourceFacade.fusionDataSet$ | async"
          class="zhealthcare-table table-first-col-border table-x-border-none" matSort matSortActive="lastName"
          matSortDisableClear matSortDirection="asc">

          <!-- Name Column -->
          <ng-container matColumnDef="lastName" [sticky]="true">
            <th id="lastName" mat-header-cell *matHeaderCellDef mat-sort-header
              [ngClass]="{'column-shadow': scrollPointer !== 0 }">
              Patient Name
            </th>
            <td mat-cell *matCellDef="let element ; let i = index" [ngClass]="{'column-shadow': scrollPointer !== 0 }">
              <div fxLayout="row" fxLayoutAlign="start center">
                <a [routerLink]="['../../details', element.id, routerPath]">
                  <span class="list-item-name">{{ element.lastName }}, {{ element.firstName }}
                  </span>
                </a>

                <zhealthcare-tag-showcase [tags]="element.tagIds | studentTags:this.tagMaster" class="ml-4">
                </zhealthcare-tag-showcase>
              </div>

            </td>
          </ng-container>

          <!-- studentNumber Column -->
          <ng-container matColumnDef="accountNo">
            <th id="student-id-header" mat-header-cell *matHeaderCellDef mat-sort-header>
              Account number
            </th>
            <td mat-cell *matCellDef="let element">
              {{ element?.accountNo }}
            </td>
          </ng-container>

          <!-- email Column -->
          <ng-container matColumnDef="roomId">
            <th id="roomId" mat-header-cell *matHeaderCellDef class="email-width" mat-sort-header>Room Id</th>
            <td mat-cell *matCellDef="let element" class="email-width">
             {{ element?.roomId }}
            </td>
          </ng-container>

          <!-- phone Column -->
          <ng-container matColumnDef="admissioinDate">
            <th id="phone" class="phone-column" mat-header-cell *matHeaderCellDef mat-sort-header>
              Admissioin Date
            </th>
            <td class="phone-column" mat-cell *matCellDef="let element">
              {{ element.admissioinDate }}
            </td>
          </ng-container>

          <!-- status Column -->
          <ng-container matColumnDef="profileStatus">
            <th id="profileStatus" class="profileStaus-column" mat-header-cell *matHeaderCellDef mat-sort-header>
              Status
            </th>
            <td mat-cell class="profileStaus-column" *matCellDef="let element">
              <span [ngClass]="{'warn-fg':element.profileStatus?.toLowerCase()==='inactive'}">{{ element.profileStatus
                }}</span>
            </td>
          </ng-container>

          <!-- cohort Column -->
          <ng-container matColumnDef="cohortName">
            <th id="cohortName" mat-header-cell *matHeaderCellDef mat-sort-header>
              Cohort
            </th>
            <td mat-cell *matCellDef="let element">
              <div>
                {{ element.cohortName }}
              </div>
            </td>
          </ng-container>

          <!-- cohort Column -->
          <ng-container matColumnDef="groupName">
            <th id="groupName" mat-header-cell *matHeaderCellDef mat-sort-header>
              Group
            </th>
            <td mat-cell *matCellDef="let element">
              {{ element.groupName }}
            </td>
          </ng-container>

          <ng-container matColumnDef="enrollmentTerm">
            <th id="enrollmentTerm" fxHide.xs mat-header-cell *matHeaderCellDef mat-sort-header>
              <span id="enrollment-header" class="grid_header_truncate" [display]="isTextOverflow('enrollment-header')"
                tooltip="Enrollment" [options]="tooltipOptions">
                Enrollment calendar
              </span>
            </th>
            <td fxHide.xs mat-cell *matCellDef="let element">
              {{ element?.enrollmentTerm }}&nbsp;<span *ngIf="element?.enrollmentTermDate">({{ element?.enrollmentTermDate | date: 'MMMM d, y'}})</span>
            </td>
          </ng-container>

          <ng-container matColumnDef="graduationTerm">
            <th id="graduationTerm" fxHide.xs mat-header-cell *matHeaderCellDef mat-sort-header>
              <span id="graduation-header" class="grid_header_truncate" [display]="isTextOverflow('graduation-header')"
                tooltip="Graduation" [options]="tooltipOptions">
                Graduation calendar
              </span>
            </th>
            <td fxHide.xs mat-cell *matCellDef="let element">
              {{ element?.graduationTerm }}&nbsp;<span *ngIf="element?.graduationTermDate">({{ element?.graduationTermDate | date: 'MMMM d, y'}})</span>
            </td>
          </ng-container>

          <ng-container matColumnDef="campus">
            <th id="campus" fxHide.xs mat-header-cell *matHeaderCellDef mat-sort-header>
              <span id="campus-header" class="grid_header_truncate" [display]="isTextOverflow('campus-header')"
                tooltip="campus" [options]="tooltipOptions">
                Campus
              </span>
            </th>
            <td fxHide.xs mat-cell *matCellDef="let element">
              {{ element?.campus }}
            </td>
          </ng-container>

          <ng-container matColumnDef="category">
            <th id="category" fxHide.xs mat-header-cell *matHeaderCellDef mat-sort-header
              class="student-category-width">
              <span id="category-header" class="grid_header_truncate" [display]="isTextOverflow('category-header')"
                tooltip="Student Category" [options]="tooltipOptions">
                Student category
              </span>
            </th>
            <td fxHide.xs mat-cell *matCellDef="let element" class="student-category-width">
              {{ element?.category }}
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns$ | async; sticky: true"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns$ | async" (click)="addRow(row)"
            [class.row-selected]="clickedRows?.has(row)" [class.row-highlighted]="highlightedRows?.has(row)"></tr>
        </table>

        <div
          *ngIf="!(datasourceFacade.fusionDataSourceLoading$ | async ) && (datasourceFacade.dataSourceTotal$ | async)===0"
          fxLayout="row wrap" fxLayoutAlign="center" class="pt-16 result-found-style warn-fg" tabindex="0"
          aria-label="2 search results found">
          We are sorry. No data found
        </div>
      </div>
    </div>
    <div #pagination>
      <mat-paginator [pageSize]="100" class="bt" [length]="datasourceFacade.dataSourceTotal$ | async"></mat-paginator>
    </div>
  </div>
</div>

<ng-template #NoData>
  <div class="result-found-style warn-fg" tabindex="0" aria-label="2 search results found">
    We are sorry. No data found
  </div>
</ng-template>
